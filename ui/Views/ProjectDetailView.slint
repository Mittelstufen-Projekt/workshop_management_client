import { ProjectDetailRow, ProjectDetailRowTwoBoxes } from "../Widgets/ProjectDetailRow.slint";
import { VerticalBox, HorizontalBox, Button, ComboBox } from "std-widgets.slint";
import { TextField } from "../Widgets/TextField.slint";
import { ProjectModel } from "../models/ProjectModel.slint";
import { ProjectView } from "ProjectView.slint";
import { Constants } from "../Constants.slint";
import { MaterialDetailCard } from "../Widgets/MaterialDetailCard.slint";
import { Palette } from "../Palette.slint";
import { Appbar } from "../Widgets/Appbar.slint";
import { WMSAppbar } from "../Widgets/WMSAppbar.slint";
import { TitleSection } from "../Widgets/TitleSeciton.slint";
import { MatDetailRow } from "../Widgets/MatDetailRow.slint";
import { MockModel } from "../models/MockModels.slint";
import { Material } from "../models/MaterialModel.slint";
import { Backend } from "../Backend.slint";
import { ClientModel } from "../models/ClientModel.slint";

// TODO(jmeusel): Save button anders anordnen, Email feld checken, X Button für Materialien, Listen müssen dabei geupdated werden
// TODO(jmeusel): client, phone und email benötigen eigenes Feld und eigenen Screen 
// TODO(jmeusel): client muss durch dropdown geändert werden
// TODO(jmeusel): Wenn die Liste Leer ist, müssen die Felder initial leer sein
export component ProjectDetailView inherits VerticalLayout {
    in-out property <ProjectModel> project;
    in-out property <[string]> clients;


    property <Material> mock;
    mock: { name: "Name", type: "Type", description: "", price: 0, quantity: 0 };

    property <string> suffix: ": ";
    property <length> topPadding: 20px;

    VerticalLayout {
        padding: topPadding;
        Rectangle {
            height: topPadding;
        }

        alignment: start;
        TitleSection {
            title: project.name;
        }

        HorizontalLayout {
            alignment: start;
            VerticalBox {
                Rectangle {
                    height: topPadding;
                }

                Rectangle {
                    height: 20px;
                }

                alignment: start;
                projectName:= ProjectDetailRow {
                    title: Constants.project_name;
                    textFieldName: project.name;
                }

                Rectangle {
                    height: 20px;
                }

                clientName:= ProjectDetailRow {
                    title: Constants.client + suffix;
                    textFieldName: project.client.firstName + " " + project.client.lastName;
                }
                ComboBox {
                        model: clients;
                        }

                // Rectangle {
                //     height: 20px;
                // }

                // TODO(jmeusel): Client.........fIeld
                // TODO(jmeusel): BIG FUCKING TODO MEN

                Rectangle {
                    height: 20px;
                }

                projectStart:= ProjectDetailRow {
                    title: Constants.project_start + suffix;
                    textFieldName: project.project-start;
                }

                Rectangle {
                    height: 20px;
                }

                projectDeadline:= ProjectDetailRow {
                    title: Constants.project_deadline + suffix;
                    textFieldName: project.project-deadline;
                }

                Rectangle {
                    height: 20px;
                }

                projectCalculatedCosts:= ProjectDetailRow {
                    title: Constants.calculated_costs + suffix;
                    textFieldName: project.calculated-costs;
                }

                Rectangle {
                    height: 20px;
                }

                projectCurrentCosts:= ProjectDetailRow {
                    title: Constants.currentCosts + suffix;
                    textFieldName: project.current-costs;
                }
            }

            Rectangle {
                width: 400px;
            }

            //Material Section
            VerticalLayout {
                Rectangle {
                    height: topPadding;
                }

                VerticalBox {
                    HorizontalBox {
                        Text {
                            text: Constants.name;
                            font-size: Palette.font-size * 1px;
                        }

                        Text {
                            text: Constants.type;
                            font-size: Palette.font-size * 1px;
                        }

                        Text {
                            text: Constants.amount;
                            font-size: Palette.font-size * 1px;
                        }
                    }

                    for material[i] in project.mats: MatDetailRow {
                        material: project.mats[i];
                        onClick => {
                            Backend.deleteMaterial(project.mats[i].id)
                        }
                        // TODO(jmeusel): unnötig?
                            for name[index] in project.mats: Rectangle {
                            height: 85px;
                        }
                    }
                }

                //  }
                Rectangle {
                    height: 25px;
                }

                HorizontalLayout {
                    alignment: space-between;
                    Button {
                        text: Constants.add_material;
                        height: 30px;
                        width: 130px;
                        callback addMaterial(// TODO(jmeusel): implement
                        );
                    }

                    Rectangle {
                        width: 100px;
                    }

                    Button {
                        text: Constants.save;
                        height: 30px;
                        width: 130px;
                        clicked => {
                            Backend.save-project-and-used-materials(
                                projectName.textFieldName,
                                clientName.textFieldName,
                                projectStart.textFieldName,
                                projectDeadline.textFieldName,
                                projectCalculatedCosts.textFieldName,
                                projectCurrentCosts.textFieldName,
                                // TODO(jmeusel): Materialien müssen ebenfalls noch übergeben werden
                            )
                        }
                    }
                }
            }
        }
    }
}
